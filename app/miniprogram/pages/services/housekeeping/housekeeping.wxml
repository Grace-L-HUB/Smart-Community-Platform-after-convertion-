<view class="container">
  <!-- 加载状态 -->
  <van-loading wx:if="{{loading}}" size="32px">加载服务项目中...</van-loading>

  <!-- 服务项目网格 -->
  <view wx:else class="service-grid">
    <block wx:for="{{services}}" wx:key="id">
      <view class="service-card" bind:tap="onServiceClick" data-id="{{item.id}}">
        <image class="service-icon" src="{{item.icon}}"></image>
        <text class="service-name">{{item.name}}</text>
        <text class="service-description">{{item.description}}</text>
        <view class="price-group">
          <text class="service-price">¥{{item.price}}/次</text>
          <text class="original-price" wx:if="{{item.originalPrice && item.originalPrice > 0}}">¥{{item.originalPrice}}</text>
        </view>
      </view>
    </block>
  </view>

  <view class="form-section card">
    <view class="section-title">预约信息</view>
    <van-field label="服务类型" value="{{selectedService}}" placeholder="请选择服务" is-link readonly clickable bind:click-input="showServicePicker" bind:click="showServicePicker" required />
    <van-field label="服务时间" value="{{serviceTime}}" placeholder="请选择时间" is-link readonly clickable bind:click-input="showTimePicker" bind:click="showTimePicker" required />
    <van-field label="服务地址" value="{{address}}" placeholder="请输入详细地址" bind:change="onAddressChange" required />
    <van-field label="联系电话" value="{{phone}}" type="number" placeholder="请输入联系电话" bind:change="onPhoneChange" required />
    <van-field label="特殊要求" value="{{remark}}" type="textarea" placeholder="选填" bind:change="onRemarkChange" autosize />
  </view>

  <view class="submit-section">
    <van-button 
      block 
      round 
      color="#07c160" 
      bind:click="onSubmit"
      loading="{{submitting}}"
      disabled="{{!selectedService || !serviceTime || !address || !phone || submitting}}"
    >
      {{submitting ? '预约中...' : '立即预约'}}
    </van-button>
  </view>

  <van-popup show="{{showService}}" position="bottom" round bind:close="closeServicePicker">
    <van-picker
      show-toolbar
      title="请选择服务类型"
      columns="{{serviceNames}}"
      bind:confirm="onServiceConfirm"
      bind:cancel="closeServicePicker"
    />
  </van-popup>

  <van-popup show="{{showTime}}" position="bottom" round bind:close="closeTimePicker">
    <van-datetime-picker type="datetime" value="{{currentDate}}" min-date="{{minDate}}" bind:confirm="onTimeConfirm" bind:cancel="closeTimePicker" />
  </van-popup>
</view>
