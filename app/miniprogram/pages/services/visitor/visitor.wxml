<view class="container">
  <van-tabs active="{{ activeTab }}" color="#07c160" bind:change="onTabChange">
    <van-tab title="访客记录"></van-tab>
    <van-tab title="邀请访客"></van-tab>
  </van-tabs>

  <!-- Visitor Records -->
  <view class="tab-content" wx:if="{{activeTab === 0}}">
    <view class="visitor-list" wx:if="{{visitors.length > 0}}">
      <block wx:for="{{visitors}}" wx:key="id">
        <view class="visitor-card">
          <view class="visitor-header">
            <text class="visitor-name">{{item.name}}</text>
            <van-tag type="{{item.status === 'visited' ? 'success' : item.status === 'pending' ? 'primary' : 'default'}}">
              {{item.statusText}}
            </van-tag>
          </view>
          <van-cell-group border="{{false}}">
            <van-cell title="手机号" value="{{item.phone}}" />
            <van-cell title="访问日期" value="{{item.visit_time}}" />
            <van-cell title="车牌号" value="{{item.car_number || '无'}}" />
          </van-cell-group>
          <view class="visitor-actions" wx:if="{{item.status === 'pending'}}">
            <van-button size="small" round bind:tap="onShowQR" data-id="{{item.id}}">查看二维码</van-button>
            <van-button size="small" round plain type="danger" bind:tap="onCancel" data-id="{{item.id}}">取消</van-button>
          </view>
        </view>
      </block>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <van-empty description="暂无访客记录" />
    </view>
  </view>

  <!-- Invite Visitor -->
  <view class="tab-content" wx:else>
    <view class="invite-form">
      <van-field label="访客姓名" value="{{ form.name }}" placeholder="请输入访客姓名" bind:change="onNameChange" required />
      <van-field label="手机号" value="{{ form.phone }}" type="number" placeholder="请输入访客手机号" bind:change="onPhoneChange" required />
      <van-field label="车牌号" value="{{ form.carNumber }}" placeholder="选填" bind:change="onCarChange" />
      <van-field
        label="访问日期"
        value="{{ form.visitDate }}"
        placeholder="请选择访问日期"
        is-link
        readonly
        bind:click="showTimePicker"
        bind:tap="showTimePicker"
        required
      />
      <van-field label="备注" value="{{ form.reason }}" type="textarea" placeholder="选填" bind:change="onRemarkChange" autosize />
      
      <view class="submit-btn">
        <van-button 
          block 
          round 
          color="#07c160" 
          loading="{{loading}}"
          disabled="{{loading}}"
          bind:click="onInvite">
          {{loading ? '发送中...' : '发送邀请'}}
        </van-button>
      </view>
    </view>
  </view>

  <!-- Time Picker -->
  <van-popup show="{{ showPicker }}" position="bottom" bind:close="closeTimePicker" round>
    <van-datetime-picker
      type="date"
      value="{{ currentDate }}"
      min-date="{{ minDate }}"
      bind:confirm="onTimeConfirm"
      bind:cancel="closeTimePicker"
      title="选择访问日期"
      show-toolbar="{{ true }}"
      formatter="{{ formatter }}"
    />
  </van-popup>
</view>
