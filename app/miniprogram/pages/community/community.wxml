<view class="container">
  <van-search placeholder="搜索闲置物品/帖子" shape="round" background="#f7f8fa" />
  
  <van-tabs active="{{ active }}" color="#07c160" sticky bind:change="onTabChange">
    <!-- Tab 1: Second-hand Market -->
    <van-tab title="二手闲置">
      <view class="p-30">
        <block wx:for="{{ marketItems }}" wx:key="id">
          <view class="community-card" bind:tap="onMarketItemClick" data-id="{{item.id}}">
            <view class="user-row">
              <image class="avatar-small" src="{{item.avatar}}"></image>
              <text class="username">{{item.user}}</text>
              <text class="time">{{item.time}}</text>
            </view>
            <view class="content">
              <text class="title">{{item.title}}</text>
              <image wx:if="{{item.image}}" class="post-image" mode="aspectFill" src="{{item.image}}"></image>
              <view class="price-row" wx:if="{{item.price}}">
                 <text class="price">¥ {{item.price}}</text>
              </view>
            </view>
            <view class="actions">
               <van-button size="mini" icon="chat-o" catch:tap="onChatClick">私聊</van-button>
            </view>
          </view>
        </block>
      </view>
    </van-tab>

    <!-- Tab 2: Neighborhood Help -->
    <van-tab title="邻居互助">
      <view class="p-30">
        <block wx:for="{{ helpPosts }}" wx:key="id">
          <view class="community-card" bind:tap="onHelpClick" data-id="{{item.id}}">
            <view class="user-row">
              <image wx:if="{{item.publisher.avatar}}" class="avatar-small" src="{{item.publisher.avatar}}"></image>
              <view wx:else class="avatar-placeholder">{{item.publisher.display_name.charAt(0) || item.publisher.nickname.charAt(0)}}</view>
              <text class="username">{{item.publisher.display_name || item.publisher.nickname}}</text>
              <text class="time">{{item.time_ago}}</text>
            </view>
            <view class="content">
              <text class="title">{{item.title || item.content}}</text>
            </view>
            <view class="tags" wx:if="{{item.tag}}">
              <van-tag type="{{item.tag === '急' ? 'danger' : 'primary'}}">{{item.tag}}</van-tag>
              <van-tag wx:if="{{item.is_urgent}}" type="warning">紧急</van-tag>
              <van-tag wx:if="{{item.is_resolved}}" type="success">已解决</van-tag>
            </view>
            <view class="meta-info">
              <text class="meta-text">浏览 {{item.view_count}} · 回复 {{item.response_count}}</text>
            </view>
            <view class="actions">
              <van-button size="mini" type="primary" catch:tap="onHelpButtonClick" data-id="{{item.id}}" disabled="{{item.is_resolved}}">
                {{item.is_resolved ? '已解决' : '我来帮'}}
              </van-button>
            </view>
          </view>
        </block>
        
        <!-- 空状态 -->
        <view wx:if="{{helpPosts.length === 0 && !loading}}" class="empty-state">
          <van-empty description="暂无求助信息" />
        </view>
        
        <!-- 加载状态 -->
        <van-loading wx:if="{{loading}}" type="spinner" color="#07c160">加载中...</van-loading>
      </view>
    </van-tab>

    <!-- Tab 3: Community Events -->
    <van-tab title="社区活动">
       <view class="p-30">
         <view class="event-card" bind:tap="onEventClick" data-id="1">
           <image class="event-banner" src="https://img.yzcdn.cn/vant/apple-1.jpg" mode="aspectFill"></image>
           <view class="event-info">
             <text class="event-title">周末亲子绘画比赛报名啦！</text>
             <text class="event-time">时间：本周六 下午2:00</text>
             <text class="event-loc">地点：社区活动中心2楼</text>
             <van-button block color="#07c160" round size="small" custom-class="mt-20" catch:tap="onEventEnrollClick">立即报名</van-button>
           </view>
         </view>
       </view>
    </van-tab>
  </van-tabs>
  
  <!-- Floating Action Button for Posting -->
  <view class="fab-btn" bind:tap="onPostClick">
    <van-icon name="plus" size="30px" color="#fff" />
  </view>
</view>
