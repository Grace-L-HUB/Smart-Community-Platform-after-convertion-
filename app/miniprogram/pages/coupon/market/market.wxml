<view class="container">
  <!-- 标题栏 -->
  <view class="header">
    <text class="title">优惠券市场</text>
    <van-button size="small" round plain bindtap="onViewMyCoupons">
      我的优惠券
    </van-button>
  </view>

  <!-- 加载状态 -->
  <van-loading wx:if="{{ loading }}" type="spinner" color="#1989fa" vertical class="loading-container">
    加载中...
  </van-loading>
  
  <!-- 错误状态 -->
  <view wx:elif="{{ error }}" class="error-container">
    <van-empty description="{{ error }}">
      <van-button round type="primary" class="bottom-button" bindtap="onRefresh">
        重新加载
      </van-button>
    </van-empty>
  </view>
  
  <!-- 优惠券列表 -->
  <view wx:else class="coupon-list">
    <view wx:if="{{ coupons.length === 0 }}" class="empty-container">
      <van-empty description="暂无可领取的优惠券" />
    </view>
    
    <view wx:else>
      <view 
        wx:for="{{ coupons }}" 
        wx:key="id" 
        class="coupon-card"
      >
        <!-- 优惠券主体 -->
        <view class="coupon-main">
          <!-- 左侧金额区域 -->
          <view class="coupon-amount">
            <text class="amount-symbol">¥</text>
            <text class="amount-value">{{ item.amount }}</text>
            <text class="amount-condition">满{{ item.minAmount }}可用</text>
          </view>
          
          <!-- 中间信息区域 -->
          <view class="coupon-info">
            <view class="coupon-name">{{ item.name }}</view>
            <view class="coupon-desc">{{ item.description }}</view>
            <view 
              class="coupon-merchant"
              data-merchant-id="{{ item.merchantId }}"
              bindtap="onMerchantClick"
            >
              <van-icon name="shop-o" size="12px" />
              <text class="merchant-name">{{ item.merchantName }}</text>
              <van-icon name="arrow" size="12px" />
            </view>
            <view class="coupon-time">
              有效期：{{ item.startDate.split('T')[0] }} 至 {{ item.endDate.split('T')[0] }}
            </view>
          </view>
          
          <!-- 右侧领取按钮 -->
          <view class="coupon-action">
            <van-button 
              size="small" 
              type="primary" 
              round
              loading="{{ receivingCouponId === item.id }}"
              disabled="{{ item.remainingCount <= 0 }}"
              data-id="{{ item.id }}"
              bindtap="onReceiveCoupon"
            >
              {{ item.remainingCount <= 0 ? '已抢完' : '立即领取' }}
            </van-button>
          </view>
        </view>
        
        <!-- 优惠券底部信息 -->
        <view class="coupon-footer">
          <view class="coupon-stats">
            <text class="stats-item">剩余 {{ item.remainingCount }}/{{ item.totalCount }}</text>
            <text class="stats-item">每人限领 {{ item.perUserLimit }} 张</text>
          </view>
          <view class="coupon-type">
            <van-tag size="mini" type="primary">{{ item.typeDisplay }}</van-tag>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部提示 -->
  <view class="footer-tip">
    <van-icon name="info-o" size="14px" />
    <text class="tip-text">优惠券领取后可在"我的优惠券"中查看和使用</text>
  </view>
</view>
